{% extends "base.html" %}
{% block content %}

{% set notice = request.query_params.get('notice') %}
{% if notice %}
<div class="notice {% if notice in ['gen-ok'] %}success{% elif notice in ['configs-cleared','db-reset'] %}warn{% else %}info{% endif %}">
  {% if notice == 'gen-ok' %}
    ‚úÖ Fichiers de configurations g√©n√©r√©es, vous pouvez d√©sormais les t√©l√©charger.
  {% elif notice == 'configs-cleared' %}
    üßπ Tous les fichiers .conf ont √©t√© effac√©s.
  {% elif notice == 'db-reset' %}
    ‚ôªÔ∏è Base de donn√©es r√©initialis√©e et configs supprim√©es.
  {% else %}
    ‚ÑπÔ∏è Action effectu√©e.
  {% endif %}
</div>
{% endif %}

<div class="card card-tight">
  <h2 class="card-title">Dashboard</h2>
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-accent"></div>
      <div class="stat-value">{{ nodes|length }}</div>
      <div class="stat-label">N≈ìuds</div>
    </div>
    <div class="stat-card">
      <div class="stat-accent"></div>
      <div class="stat-value">{{ users|length }}</div>
      <div class="stat-label">Utilisateurs</div>
    </div>
  </div>
</div>

<div class="card card-tight">
  <h2 class="card-title">Gestion</h2>
  <div class="button-grid">
    <a class="button light has-tip" href="/nodes"
       data-tip="Acc√©der √† la gestion des n≈ìuds (ajout, IP publique/VPN, MTU, port).">
      G√©rer les n≈ìuds
    </a>

    <a class="button light has-tip" href="/users"
       data-tip="Acc√©der √† la gestion des utilisateurs (ajout, IP VPN, MTU).">
      G√©rer les utilisateurs
    </a>

    <a class="button light has-tip" href="/overview"
       data-tip="Voir l‚Äôaper√ßu global : n≈ìuds et utilisateurs avec IP/ports/MTU/cl√©s.">
      Aper√ßu
    </a>
  </div>
</div>

<div class="card card-tight">
  <h2 class="card-title">Op√©rations</h2>

  <div class="ops-row">
    <form action="/genmesh" method="post" class="inline-form">
      <button type="submit" class="button light wide has-tip"
              data-tip="G√©n√©rer ou reg√©n√©rer les fichiers de configuration WireGuard pour tous les n≈ìuds et utilisateurs.">
        G√©n√©rer / Reg√©n√©rer
      </button>
    </form>

    <a class="button light wide has-tip" href="/configs/all.zip"
       data-tip="T√©l√©charger toutes les configurations g√©n√©r√©es dans un fichier ZIP.">
      T√©l√©charger
    </a>
  </div>

  <div class="ops-row">
    <form action="/configs/clear" method="post" class="inline-form"
          onsubmit="return confirm('Effacer tous les fichiers .conf g√©n√©r√©s ?');">
      <button type="submit" class="button dark wide has-tip"
              data-tip="Effacer les fichiers de configuration g√©n√©r√©s pr√©c√©demment (les donn√©es en base restent).">
        Effacer
      </button>
    </form>

    <form action="/reset-db" method="post" class="inline-form"
          onsubmit="return confirm('R√©initialiser la base et supprimer toutes les configs ? Action irr√©versible.');">
      <button type="submit" class="button danger wide has-tip"
              data-tip="Effacer toutes les donn√©es dans la base de donn√©es et supprimer les fichiers de configuration.">
        R√©initialiser
      </button>
    </form>
  </div>
</div>
{% endblock %}
